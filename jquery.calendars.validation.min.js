/* http://keith-wood.name/calendars.html
   Calendars Validation extension for jQuery 1.1.4.
   Requires Jörn Zaefferer's Validation plugin (http://plugins.jquery.com/project/validate).
   Written by Keith Wood (kbwood{at}iinet.com.au).
   Dual licensed under the GPL (http://dev.jquery.com/browser/trunk/jquery/GPL-LICENSE.txt) and 
   MIT (http://dev.jquery.com/browser/trunk/jquery/MIT-LICENSE.txt) licenses. 
   Please attribute the author if you use it. */
(function($){if($.fn.validate){$.calendars.picker.selectDateOrig=$.calendars.picker.selectDate;$.extend($.calendars.picker.regional[''],{validateDate:'Please enter a valid date',validateDateMin:'Please enter a date on or after {0}',validateDateMax:'Please enter a date on or before {0}',validateDateMinMax:'Please enter a date between {0} and {1}',validateDateCompare:'Please enter a date {0} {1}',validateDateToday:'today',validateDateOther:'the other date',validateDateEQ:'equal to',validateDateNE:'not equal to',validateDateLT:'before',validateDateGT:'after',validateDateLE:'not after',validateDateGE:'not before'});$.extend($.calendars.picker._defaults,$.calendars.picker.regional['']);$.extend($.calendars.picker,{selectDate:function(a,b){this.selectDateOrig(a,b);var c=$.data(a,$.calendars.picker.dataName);if(!c.inline&&$.fn.validate){var d=$(a).parents('form').validate();if(d){d.element('#'+a.id)}}},errorPlacement:function(a,b){var c=$.data(b[0],$.calendars.picker.dataName);if(c){a[c.get('isRTL')?'insertBefore':'insertAfter'](c.trigger.length>0?c.trigger:b)}else{a.insertAfter(b)}},errorFormat:function(c,d){var e=($.calendars.picker.curInst?$.calendars.picker.curInst.get('dateFormat'):$.calendars.picker._defaults.dateFormat);$.each(d,function(a,b){c=c.replace(new RegExp('\\{'+a+'\\}','g'),b.formatDate(e)||'nothing')});return c}});var n=null;$.validator.addMethod('cpDate',function(a,b,c){n=b;return this.optional(b)||validateEach(a,b)},function(a){var b=$.data(n,$.calendars.picker.dataName);var c=b.get('minDate');var d=b.get('maxDate');var e=$.calendars.picker._defaults;return(c&&d?$.calendars.picker.errorFormat(e.validateDateMinMax,[c,d]):(c?$.calendars.picker.errorFormat(e.validateDateMin,[c]):(d?$.calendars.picker.errorFormat(e.validateDateMax,[d]):e.validateDate)))});function validateEach(a,b){var c=$.data(b,$.calendars.picker.dataName);var d=c.get('rangeSelect');var f=c.get('multiSelect');var g=(f?a.split(c.get('multiSeparator')):(d?a.split(c.get('rangeSeparator')):[a]));var h=(f&&g.length<=f)||(!f&&d&&g.length==2)||(!f&&!d&&g.length==1);if(h){try{var j=c.get('dateFormat');var k=c.get('minDate');var l=c.get('maxDate');var m=$(b);$.each(g,function(i,v){g[i]=c.get('calendar').parseDate(j,v);h=h&&(!g[i]||(m.calendarsPicker('isSelectable',g[i])&&(!k||g[i].compareTo(k)!=-1)&&(!l||g[i].compareTo(l)!=+1)))})}catch(e){h=false}}if(h&&d){h=(g[0].compareTo(g[1])!=+1)}return h}$.validator.addClassRules('cpDate',{cpDate:true});var o={equal:'eq',same:'eq',notEqual:'ne',notSame:'ne',lessThan:'lt',before:'lt',greaterThan:'gt',after:'gt',notLessThan:'ge',notBefore:'ge',notGreaterThan:'le',notAfter:'le'};$.validator.addMethod('cpCompareDate',function(a,b,c){if(this.optional(b)){return true}c=normaliseParams(c);var d=$(b).calendarsPicker('getDate');var e=extractOtherDate(b,c[1]);if(d.length==0||e.length==0){return true}n=b;var f=true;for(var i=0;i<d.length;i++){var g=d[i].compareTo(e[0]);switch(o[c[0]]||c[0]){case'eq':f=(g==0);break;case'ne':f=(g!=0);break;case'lt':f=(g<0);break;case'gt':f=(g>0);break;case'le':f=(g<=0);break;case'ge':f=(g>=0);break;default:f=true}if(!f){break}}return f},function(a){var b=$.calendars.picker._defaults;a=normaliseParams(a);var c=extractOtherDate(n,a[1],true);c=(a[1]=='today'?b.validateDateToday:(c.length?c[0].formatDate():b.validateDateOther));return b.validateDateCompare.replace(/\{0\}/,b['validateDate'+(o[a[0]]||a[0]).toUpperCase()]).replace(/\{1\}/,c)});function normaliseParams(a){if(typeof a=='string'){a=a.split(' ')}else if(!$.isArray(a)){var b=[];for(var c in a){b[0]=c;b[1]=a[c]}a=b}return a}function extractOtherDate(a,b,c){if(b.newDate&&b.extraInfo){return[b]}var d=$.data(a,$.calendars.picker.dataName);var f=d.get('calendar');var g=null;try{if(typeof b=='string'&&b!='today'){g=f.parseDate(d.get('dateFormat'),b)}}catch(e){}g=(g?[g]:(b=='today'?[f.today()]:(c?[]:$(b).calendarsPicker('getDate'))));return g}}})(jQuery);